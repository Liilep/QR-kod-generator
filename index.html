<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <title>August's QR-kod Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f8f9fa;
        }
        textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            font-size: 14px;
        }
        input {
            padding: 5px;
            margin-right: 5px;
            font-size: 14px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin-top: 10px;
            cursor: pointer;
        }
        .qr-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        .qr-item {
            text-align: center;
        }
        .qr-item img {
            border: 1px solid #ccc;
            background: white;
            padding: 5px;
        }
        .download-btn {
            display: inline-block;
            margin-top: 5px;
            padding: 5px 10px;
            font-size: 14px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .download-btn:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>August's QR-kod Generator</h1>
    <p>Klistra in dina URL:er (en per rad):</p>
    <textarea id="urlList" placeholder="https://exempel.com&#10;https://openai.com"></textarea>
    <br><br>
    <p>Sätt namn och intervall för bilderna:</p>
    <input type="text" id="filePrefix" placeholder="Exempel: Loge">
    <input type="number" id="startNumber" placeholder="Startnummer" style="width:100px;">
    <input type="number" id="endNumber" placeholder="Slutnummer" style="width:100px;">
    <br><br>
    <button onclick="generateQRCodes()">Generera QR-koder</button>
    <button id="downloadAllBtn" style="display:none;" onclick="downloadAll()">Ladda ner alla</button>
    
    <div id="qrCodes" class="qr-container"></div>

    <!-- QRCode.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- JSZip -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- FileSaver.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script>
        let generatedImages = [];

        function generateQRCodes() {
            const qrContainer = document.getElementById('qrCodes');
            const downloadAllBtn = document.getElementById('downloadAllBtn');
            qrContainer.innerHTML = '';
            generatedImages = [];

            const urls = document.getElementById('urlList').value
                .split('\n')
                .map(url => url.trim())
                .filter(url => url.length > 0);

            if (urls.length === 0) {
                downloadAllBtn.style.display = 'none';
                return;
            }

            const prefix = document.getElementById('filePrefix').value || 'QR';
            let startNum = parseInt(document.getElementById('startNumber').value) || 1;
            const endNum = parseInt(document.getElementById('endNumber').value) || (startNum + urls.length - 1);

            if (urls.length > (endNum - startNum + 1)) {
                alert("Antalet URL:er överstiger det angivna intervallet! Justera start- eller slutnummer.");
                return;
            }

            urls.forEach((url, index) => {
                if (startNum + index > endNum) return;

                const qrDiv = document.createElement('div');
                qrDiv.classList.add('qr-item');

                const qrCodeDiv = document.createElement('div');
                qrDiv.appendChild(qrCodeDiv);

                const label = document.createElement('p');
                label.textContent = url;
                qrDiv.appendChild(label);

                const downloadBtn = document.createElement('button');
                downloadBtn.textContent = 'Ladda ner';
                downloadBtn.classList.add('download-btn');
                qrDiv.appendChild(downloadBtn);

                qrContainer.appendChild(qrDiv);

                new QRCode(qrCodeDiv, {
                    text: url,
                    width: 150,
                    height: 150
                });

                setTimeout(() => {
                    const img = qrCodeDiv.querySelector('img');
                    if (img) {
                        const fileName = `${prefix} ${startNum + index}.png`;
                        generatedImages.push({ fileName, src: img.src });

                        downloadBtn.onclick = () => {
                            const a = document.createElement('a');
                            a.href = img.src;
                            a.download = fileName;
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                        };
                    }
                }, 300);
            });

            setTimeout(() => {
                downloadAllBtn.style.display = generatedImages.length > 0 ? 'inline-block' : 'none';
            }, 500);
        }

        function sanitizeFileName(url) {
            return url.replace(/[^a-z0-9]/gi, '_').substring(0, 50);
        }

        function downloadAll() {
            if (generatedImages.length === 0) return;

            const zip = new JSZip();
            const imgFolder = zip.folder("QR_koder");

            generatedImages.forEach(img => {
                const base64Data = img.src.split(',')[1];
                imgFolder.file(img.fileName, base64ToBlob(base64Data), { binary: true });
            });

            zip.generateAsync({ type: "blob" }).then(content => {
                saveAs(content, "QR_koder.zip");
            });
        }

        function base64ToBlob(base64) {
            const byteCharacters = atob(base64);
            const byteNumbers = new Array(byteCharacters.length);
            for (let i = 0; i < byteCharacters.length; i++) {
                byteNumbers[i] = byteCharacters.charCodeAt(i);
            }
            return new Blob([new Uint8Array(byteNumbers)], { type: 'image/png' });
        }
    </script>
</body>
</html>
