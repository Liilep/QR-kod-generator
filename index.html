<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <title>August's QR-kod Generator</title>
    <style>
        /* ====== Grundlayout ====== */
        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            background: #f4f6f9;
            color: #333;
            padding: 20px;
        }
        h1 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 2rem;
            font-weight: 600;
            color: #222;
        }
        p {
            margin: 10px 0 5px;
        }

        /* ====== Formulär ====== */
        textarea, input, button {
            font-family: inherit;
            border-radius: 8px;
            font-size: 15px;
            border: 1px solid #ccc;
            padding: 10px;
            transition: all 0.2s ease-in-out;
        }
        textarea {
            width: 100%;
            height: 140px;
            resize: vertical;
        }
        input[type="text"], input[type="number"] {
            width: 180px;
            margin-right: 10px;
        }
        textarea:focus, input:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: 0 0 0 3px rgba(74,144,226,0.2);
        }

        label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 12px 0;
        }

        /* ====== Knappar ====== */
        button {
            cursor: pointer;
            border: none;
            background: #4a90e2;
            color: white;
            font-size: 15px;
            font-weight: 500;
            padding: 10px 18px;
            border-radius: 8px;
            margin-top: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        button:hover {
            background: #357ABD;
        }
        #downloadAllBtn {
            background: #34a853;
        }
        #downloadAllBtn:hover {
            background: #2a8642;
        }

        /* ====== QR-container ====== */
        .qr-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        .qr-item {
            text-align: center;
            background: #fff;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            transition: transform 0.2s ease;
        }
        .qr-item:hover {
            transform: translateY(-5px);
        }
        .qr-item p {
            font-size: 13px;
            word-break: break-word;
            color: #666;
        }
        .qr-item img {
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .download-btn {
            background: #ff9800;
            color: #fff;
            font-size: 14px;
            border-radius: 6px;
            padding: 6px 12px;
            margin-top: 6px;
        }
        .download-btn:hover {
            background: #e68900;
        }
    </style>
</head>
<body>
    <h1>August's QR-kod Generator</h1>
    <p>Klistra in dina URL:er (en per rad):</p>
    <textarea id="urlList" placeholder="https://exempel.com&#10;https://openai.com"></textarea>
    <br><br>
    <p>Sätt namn och intervall för bilderna:</p>
    <input type="text" id="filePrefix" placeholder="Exempel: Loge">
    <input type="number" id="startNumber" placeholder="Startnummer" style="width:100px;">
    <input type="number" id="endNumber" placeholder="Slutnummer" style="width:100px;">
    <br><br>
    <label><input type="checkbox" id="showName"> Visa namn under QR-koden</label>
    <br><br>
    <button onclick="generateQRCodes()">Generera QR-koder</button>
    <button id="downloadAllBtn" style="display:none;" onclick="downloadAll()">Ladda ner alla</button>
    
    <div id="qrCodes" class="qr-container"></div>

    <!-- QRCode.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- JSZip -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- FileSaver.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script>
        let generatedImages = [];

        function generateQRCodes() {
            const qrContainer = document.getElementById('qrCodes');
            const downloadAllBtn = document.getElementById('downloadAllBtn');
            qrContainer.innerHTML = '';
            generatedImages = [];

            const urls = document.getElementById('urlList').value
                .split('\n')
                .map(url => url.trim())
                .filter(url => url.length > 0);

            if (urls.length === 0) {
                downloadAllBtn.style.display = 'none';
                return;
            }

            const prefix = document.getElementById('filePrefix').value || 'QR';
            let startNum = parseInt(document.getElementById('startNumber').value) || 1;
            const endNum = parseInt(document.getElementById('endNumber').value) || (startNum + urls.length - 1);
            const showName = document.getElementById('showName').checked;

            if (urls.length > (endNum - startNum + 1)) {
                alert("Antalet URL:er överstiger det angivna intervallet! Justera start- eller slutnummer.");
                return;
            }

            urls.forEach((url, index) => {
                if (startNum + index > endNum) return;

                const qrDiv = document.createElement('div');
                qrDiv.classList.add('qr-item');

                const qrCodeDiv = document.createElement('div');
                qrDiv.appendChild(qrCodeDiv);

                const label = document.createElement('p');
                label.textContent = url;
                qrDiv.appendChild(label);

                const downloadBtn = document.createElement('button');
                downloadBtn.textContent = 'Ladda ner';
                downloadBtn.classList.add('download-btn');
                qrDiv.appendChild(downloadBtn);

                qrContainer.appendChild(qrDiv);

                // Skapa QR
                new QRCode(qrCodeDiv, {
                    text: url,
                    width: 150,
                    height: 150
                });

                setTimeout(() => {
                    const img = qrCodeDiv.querySelector('img');
                    if (img) {
                        let fileName = `${prefix} ${startNum + index}.png`;
                        generatedImages.push({ fileName, src: img.src });

                        // Om bockruta är vald, skapa canvas med text under QR
                        if (showName) {
                            const canvas = document.createElement('canvas');
                            const image = new Image();
                            image.src = img.src;
                            image.onload = () => {
                                canvas.width = image.width;
                                canvas.height = image.height + 20;
                                const ctx = canvas.getContext('2d');
                                ctx.fillStyle = "#ffffff";
                                ctx.fillRect(0,0,canvas.width,canvas.height);
                                ctx.drawImage(image, 0, 0);
                                ctx.fillStyle = "#000000";
                                ctx.font = "16px Arial";
                                ctx.textAlign = "center";
                                ctx.fillText(fileName.replace('.png',''), canvas.width/2, canvas.height-5);
                                img.src = canvas.toDataURL("image/png");
                                generatedImages[index].src = img.src;
                            };
                        }

                        downloadBtn.onclick = () => {
                            const a = document.createElement('a');
                            a.href = img.src;
                            a.download = fileName;
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                        };
                    }
                }, 300);
            });

            setTimeout(() => {
                downloadAllBtn.style.display = generatedImages.length > 0 ? 'inline-block' : 'none';
            }, 500);
        }

        function downloadAll() {
            if (generatedImages.length === 0) return;

            const zip = new JSZip();
            const imgFolder = zip.folder("QR_koder");

            generatedImages.forEach(img => {
                const base64Data = img.src.split(',')[1];
                imgFolder.file(img.fileName, base64ToBlob(base64Data), { binary: true });
            });

            zip.generateAsync({ type: "blob" }).then(content => {
                saveAs(content, "QR_koder.zip");
            });
        }

        function base64ToBlob(base64) {
            const byteCharacters = atob(base64);
            const byteNumbers = new Array(byteCharacters.length);
            for (let i = 0; i < byteCharacters.length; i++) {
                byteNumbers[i] = byteCharacters.charCodeAt(i);
            }
            return new Blob([new Uint8Array(byteNumbers)], { type: 'image/png' });
        }
    </script>
</body>
</html>
